<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Blue Chat V7 Perfect</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { margin: 0; font-family: 'Hiragino Sans', sans-serif; overflow: hidden; color: white; background: #000; }
        .day-bg { background: linear-gradient(rgba(0,0,0,0.3),rgba(0,0,0,0.3)), url('https://images.unsplash.com/photo-1470770841072-f978cf4d019e?auto=format&fit=crop&w=1920&q=80'); background-size: cover; }
        .night-bg { background: linear-gradient(rgba(0,0,0,0.6),rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1516339901600-2e1a62dc0c45?auto=format&fit=crop&w=1920&q=80'); background-size: cover; }
        .hidden { display: none !important; }
        
        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–¢é€£ */
        .full { height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; transition: transform 0.8s cubic-bezier(0.85, 0, 0.15, 1), opacity 0.8s; }
        .success-zoom { transform: scale(5); opacity: 0; pointer-events: none; }
        .flash-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; opacity: 0; pointer-events: none; z-index: 9999; }
        .flash-active { animation: flash-anim 0.6s ease-out forwards; }
        @keyframes flash-anim { 0% { opacity: 0; } 50% { opacity: 1; } 100% { opacity: 0; } }

        .glass { background: rgba(0,0,0,0.85); backdrop-filter: blur(20px); padding: 40px; border-radius: 30px; width: 400px; border: 1px solid rgba(255,255,255,0.1); }
        
        /* ç”»é¢ä¸Šéƒ¨æƒ…å ±ãƒãƒ¼ */
        .info-bar { position: fixed; top: 0; left: 0; width: 100%; height: 50px; background: rgba(0,0,0,0.8); display: flex; justify-content: space-between; align-items: center; padding: 0 30px; z-index: 1000; font-size: 16px; font-weight: bold; border-bottom: 1px solid #333; }

        /* ãƒ“ãƒ‡ã‚ªã‚°ãƒªãƒƒãƒ‰ & ãƒŸãƒ©ãƒ¼è¨­å®š */
        #video-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); grid-auto-rows: 1fr; width: 100%; height: 100vh; padding: 70px 20px 100px 20px; gap: 20px; box-sizing: border-box; background: #121212; }
        .video-container { position: relative; width: 100%; height: 100%; border-radius: 20px; overflow: hidden; background: #000; }
        video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); } /* é¡è¨­å®š */
        video.screen-share { transform: scaleX(1) !important; object-fit: contain; } /* å…±æœ‰ã¯åè»¢ãªã— */
        
        .nickname-label { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.6); padding: 6px 14px; border-radius: 8px; font-size: 14px; }

        /* ãƒœã‚¿ãƒ³é¡ */
        .btn-main { width: 100%; padding: 18px; margin: 12px 0; border-radius: 60px; border: none; font-weight: bold; cursor: pointer; font-size: 16px; transition:0.2s; }
        .btn-blue { background: #0078d4; color: white; }
        .btn-green { background: #0f9d58; color: white; }
        .btn-approve { background: #0f9d58; color: white; border: none; padding: 5px 15px; border-radius: 20px; cursor: pointer; }
        .toolbar { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); display: flex; gap: 20px; background: rgba(30,30,30,0.9); padding: 15px 40px; border-radius: 100px; z-index: 1000; }
        .icon-btn { width: 55px; height: 55px; border-radius: 50%; border: none; background: #444; color: white; cursor: pointer; font-size: 24px; }
        
        /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
        .sidebar { position: fixed; right: -450px; top: 0; width: 400px; height: 100%; background: #1e1e1e; color: #fff; transition: 0.4s cubic-bezier(0.1, 0.7, 1.0, 0.1); z-index: 2000; padding: 25px; display: flex; flex-direction: column; box-shadow: -5px 0 30px rgba(0,0,0,0.5); box-sizing: border-box; }
        .sidebar.open { right: 0; }
        .sidebar h3 { border-bottom: 1px solid #444; padding-bottom: 10px; margin-top: 0; }
        
        /* æ‰¿èªãƒœãƒƒã‚¯ã‚¹ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        #approval-list { max-height: 200px; overflow-y: auto; margin-bottom: 20px; }
        .approval-item { background: #333; padding: 10px; margin-bottom: 8px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #555; }
    </style>
</head>
<body id="body-bg">
    <div id="flash-effect" class="flash-overlay"></div>

    <div id="screen-init" class="full"> <button class="btn-main btn-blue" style="width:300px;" onclick="initApp()">Blue Chat V7 èµ·å‹•</button> </div>
    <div id="screen-title" class="full hidden"> <h1 style="font-size:80px;">Blue Chat</h1> <button class="btn-main" style="width:250px;" onclick="startCaptcha()">ã‚¹ã‚¿ãƒ¼ãƒˆ</button> </div>
    
    <div id="screen-captcha" class="full hidden">
        <div class="glass">
            <h2>ğŸ¤– ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£èªè¨¼</h2>
            <div id="kuku-q" style="font-size:40px; margin:30px; font-weight:bold;"></div>
            <input type="number" id="kuku-a" style="width:100%; padding:15px; border-radius:10px; border:none; font-size:20px; text-align:center;" placeholder="ï¼Ÿï¼Ÿ">
            <button class="btn-main btn-blue" onclick="checkCaptcha()">èªè¨¼</button>
        </div>
    </div>

    <div id="screen-choice" class="full hidden">
        <div class="glass">
            <h2 style="margin-bottom:40px;">ãƒ¢ãƒ¼ãƒ‰é¸æŠ</h2>
            <button class="btn-main btn-blue" onclick="show('screen-lobby')">ãƒ“ãƒ‡ã‚ªé€šè©±</button>
            <button class="btn-main btn-green" onclick="window.location.href='https://blue-chat-message-edition-mresn8mmey.edgeone.dev/'">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç‰ˆã¸</button>
        </div>
    </div>

    <div id="screen-lobby" class="full hidden">
        <div class="glass">
            <h3>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®š</h3>
            <input type="text" id="user-nick" style="width:100%; padding:15px; border-radius:10px; margin-bottom:30px;" placeholder="åå‰ï¼ˆå¿…é ˆï¼‰">
            <input type="text" id="join-id" style="width:100%; padding:15px; border-radius:10px;" placeholder="ID (6æ–‡å­—)">
            <button class="btn-main btn-blue" onclick="handleJoin()">å‚åŠ ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</button>
            <button class="btn-main btn-green" onclick="handleCreate()">éƒ¨å±‹ã‚’ä½œæˆï¼ˆãƒ›ã‚¹ãƒˆï¼‰</button>
        </div>
    </div>

    <div id="screen-wait" class="full hidden"> <div class="glass"> <h2>æ‰¿èªå¾…ã¡... ğŸš‚</h2><p>ãƒ›ã‚¹ãƒˆãŒå…¥å®¤ã‚’è¨±å¯ã™ã‚‹ã¾ã§ãŠå¾…ã¡ãã ã•ã„</p> </div> </div>

    <div id="screen-call" class="hidden">
        <div class="info-bar">
            <div id="display-room-id" style="color:#0078d4">ID: ------</div>
            <div id="display-time">00:00:00</div>
        </div>
        <div id="video-grid"></div>
        
        <div class="toolbar">
            <button id="btn-mic" class="icon-btn" onclick="toggleMic()">ğŸ¤</button>
            <button id="btn-cam" class="icon-btn" onclick="toggleCam()">ğŸ“·</button>
            <button id="btn-share" class="icon-btn" onclick="toggleScreenShare()">ğŸ“¤</button>
            <button id="btn-side" class="icon-btn" onclick="toggleSidebar()">ğŸ’¬</button>
            <button class="icon-btn" style="background:#ea4335;" onclick="location.reload()">ğŸ“</button>
        </div>

        <div id="side-bar" class="sidebar">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3>ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h3>
                <button onclick="toggleSidebar()" style="border:none; background:none; color:white; font-size:24px; cursor:pointer;">Ã—</button>
            </div>
            
            <div id="approval-box-container" style="display:none;">
                <h4 style="color:#0f9d58; margin:10px 0;">å…¥å®¤ãƒªã‚¯ã‚¨ã‚¹ãƒˆ ğŸ””</h4>
                <div id="approval-list"></div>
                <hr style="border-color:#444; margin:20px 0;">
            </div>

            <h3>ãƒãƒ£ãƒƒãƒˆ</h3>
            <div id="chat-logs" style="flex:1; overflow-y:auto; padding:15px; background:#2a2a2a; border-radius:15px; margin-bottom:15px;"></div>
            <div style="display:flex; gap:10px;">
                <input type="text" id="chat-in" style="flex:1; padding:15px; border-radius:10px; border:none;" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸...">
                <button class="btn-blue" style="width:70px; border-radius:10px; border:none;" onclick="sendChat()">é€ä¿¡</button>
            </div>
        </div>
    </div>
    <script src="client.js"></script>
</body>
</html>
